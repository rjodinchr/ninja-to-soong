From be9e0f2f6a3c30f61802c3b8575ec8cbbc4dfa28 Mon Sep 17 00:00:00 2001
From: Andy Hsu <hwandy@google.com>
Date: Wed, 29 Oct 2025 07:34:55 +0000
Subject: [PATCH] meson: Support intel tools on Android.

Signed-off-by: Andy Hsu <hwandy@google.com>
Reviewed-by: Eric Engestrom <eric@engestrom.ch>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/38131>
---
 meson.build | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/meson.build b/meson.build
index 80917def523..f241ba862cd 100644
--- a/meson.build
+++ b/meson.build
@@ -1470,7 +1470,10 @@ endif
 if cc.has_header_symbol('errno.h', 'program_invocation_name',
                         args : '-D_GNU_SOURCE')
    pre_args += '-DHAVE_PROGRAM_INVOCATION_NAME'
-elif with_tools.contains('intel')
+elif with_tools.contains('intel') and not with_platform_android
+  # Intel tools is supported on Android where the program name is from
+  # `getprogname()` without `program_invocation_name` in glibc.
+  # See `src/util/u_process.c` for more details.
   error('Intel tools require the program_invocation_name variable')
 endif
 
@@ -1617,7 +1620,7 @@ if dep_thread.found()
 endif
 
 with_expat = get_option('expat') \
-  .disable_auto_if(with_platform_android or with_platform_windows) \
+  .disable_auto_if(with_platform_windows) \
   .enable_if(with_intel_tools, error_message : 'Intel tools require expat')
 
 if host_machine.system() == 'darwin'
-- 
2.51.2.997.g839fc31de9-goog

